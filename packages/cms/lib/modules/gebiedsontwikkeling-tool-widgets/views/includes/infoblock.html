<div id="default-info-block">
	<div class="header">
		Klik op de kaart om te starten
	</div>
</div>

<div id="new-idea-form-not-logged-in-container">
	<div class="header clickable" onclick="toggleInfoBlock()">
		Nieuw probleem
	</div>
	<div class="content">
		<div class="form-alert-message">
			<div style="max-width: 270px;">
				Heb je een acute melding over het afval	op straat? Maak dan een <a href="https://www.amsterdam.nl/wonen-leefomgeving/melding-openbare/" target="_blank">MORA melding</a>.
			</div>
		</div>
		<div class="not-logged-in">
			<p class="font-16">
				<strong>Om mee te kunnen praten moet je eerst aangemeld zijn.</strong>
			</p>
			<p>
				Je gaat hiervoor naar een nieuwe pagina, en komt daarna weer hier terug.
			</p>
			<a href="/oauth/login?returnTo={{data.currentUrl}}" class="button-blue">
				Aanmelden
			</a>
		</div>
	</div>
</div>

<div id="new-idea-form-container">
	<form id="new-idea-form">
		<div class="header clickable" onclick="toggleInfoBlock()">
			Nieuw probleem
		</div>
		<div class="content">

			<div class="form-alert-message">
				<div style="max-width: 270px;">
					Heb je een acute melding over het afval	op straat? Maak dan een <a href="https://www.amsterdam.nl/wonen-leefomgeving/melding-openbare/" target="_blank">MORA melding</a>.
				</div>
			</div>

			<div id="step-0" class="step open">

				<h3>1. Om welke plek gaat het</h3>

				<div class="step-content">
					<p class="font-16">
						In de buurt van:<br/>
						<span id="address-text">klik op de kaart om een plaats te selecteren</span><br/>
						<span id="city-text"></span><br/>
						<input id="location" type="hidden" value="" onchange="currentInput.location = this.value; document.querySelector('#form-warning-location').style.display = 'none';"/>
					</p>
				</div>
				<span id="form-warning-location" class="form-warning">Je hebt nog geen plaats geselecteerd</span>

			</div>
			<div id="step-1" class="step">

				<h3 onclick="toggleStep(1)">2. Wat is er hier aan de hand?</h3>

				<div class="step-content">
					<h4>Categorie:</h4>
					<p>
						<select id="categorie" value="" class="default-select" onchange="currentInput.categorie = this.value;document.querySelector('#form-warning-categorie').style.display = 'none'">
							<option value="">Maak een keuze</option>
							<option value="Volle afvalcontainer">Volle afvalcontainer</option>
							<option value="Defecte afvalcontainer">Defecte afvalcontainer</option>
							<option value="Afval naast afvalcontainer">Afval naast afvalcontainer</option>
							<option value="Afval op straat">Afval op straat</option>
							<option value="Overig">Overig</option>
						</select>
						<span id="form-warning-categorie" class="form-warning">Je hebt nog geen categorie geselecteerd</span>
					</p>

					<h4>Type afval:</h4>
					<p>
						<select id="type" value="" class="default-select" onchange="currentInput.type = this.value;document.querySelector('#form-warning-type').style.display = 'none'">
							<option value="">Maak een keuze</option>
							<option value="Papier of karton">Papier/karton</option>
							<option value="Vuilniszakken of restafval">Vuilniszakken/restafval</option>
							<option value="Plastic">Plastic</option>
							<option value="Glas">Glas</option>
							<option value="Grofvuil">Grofvuil (zoals meubels)</option>
							<option value="Klein zwerfvuil">Klein zwerfvuil</option>
							<option value="Textiel">Textiel</option>
							<option value="Overig">Overig</option>
						</select>
						<span id="form-warning-type" class="form-warning">Je hebt nog geen type afval geselecteerd</span>
					</p>

					<p>
						<h4>Heb je een idee waardoor het probleem wordt veroorzaakt?:</h4>
						<textarea id="description" rows="2" onchange="currentInput.description = this.value"  onfocus="document.querySelector('#form-warning-description').style.display = 'none'"></textarea>
						<div id="charsLeftDescription" class="charsLeft">
							<div class="min">Nog minimaal <span>0</span> tekens</div>
							<div class="max">Je hebt nog <span>0</span> tekens over.</div>
						</div>
						<span id="form-warning-description" class="form-warning">Je beschrijving is te [[langkort]]</span>
					</p>

					<p>
						<h4>Wat zou een goede oplossing zijn?</h4>
						<textarea id="solution" rows="2" onchange="currentInput.solution = this.value"  onfocus="document.querySelector('#form-warning-solution').style.display = 'none'"></textarea>
						<div id="charsLeftSolution" class="charsLeft">
							<div class="min">Nog minimaal <span>0</span> tekens</div>
							<div class="max">Je hebt nog <span>0</span> tekens over.</div>
						</div>
						<span id="form-warning-solution" class="form-warning">Je oplossing is te [[langkort]]</span>
					</p>

				</div>

			</div>
			<div id="step-2" class="step">

				<h3 onclick="toggleStep(2)">3. Wanneer gebeurt dit?</h3>

				<div class="step-content">
					<p>
						Is er een specifiek moment dat dit gebeurt? Klik op een dag om deze te selecteren.<br/>
						<br/>

						<h4>Dag van de week:</h4>
						<input id="weekday" type="hidden" value="" onchange="currentInput.weekday = this.value;"/>
						<div id="click-selector-weekday" class="click-selector">
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'ma')">ma</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'di')">di</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'wo')">wo</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'do')">do</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'vr')">vr</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'za')">za</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('weekday', 'zo')">zo</div>
						</div>

						<h4>Dagdeel:</h4>
						<input id="daypart" type="hidden" value="" onchange="currentInput.daypart = this.value;"/>
						<div id="click-selector-daypart" class="click-selector">
							<div class="option" onclick="toggleClickSelectorOptionOption('daypart', 'ochtend')">ochtend</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('daypart', 'middag')">middag</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('daypart', 'avond')">avond</div>
							<div class="option" onclick="toggleClickSelectorOptionOption('daypart', 'nacht')">nacht</div>
						</div>

						<h4>Tijdstip of andere toelichting:</h4>
						<input type="text" value="" id="timeofday" onchange="currentInput.timeofday = this.value;"/>

						<span id="form-warning-time" class="form-warning">Je moet nog een tijdstip kiezen</span>
					</p>
				</div>

			</div>
			<div id="step-3" class="step">

				<h3 onclick="toggleStep(3)">4. Heb je beeldmateriaal?</h3>

				<div class="step-content">
					<p>
						Om uw melding duidelijk te maken kan een foto van de situatie helpen.
					</p>

					<div class="form-group">
						<div id="imageUpload">
							<div class="form-info">
								Let op: Stuur alleen een foto mee die je zelf gemaakt hebt! Foto's van anderen kunnen auteursrechtelijk beschermd zijn. Je hebt toestemming nodig van de fotograaf om die foto te uploaden.
							</div>
							<span id="form-warning-images" class="form-warning">Het uploaden van images is nog niet afgerond</span>
							<fieldset class="filepondFieldset2">
								<!-- a list of already uploaded files -->
								{% if idea.extraData.images %}
						    {#<ul>
								{% for image in idea.extraData.images %}
						    <li>
						      <label>
						        <input value="{{image}}" data-type="remote" checked type="checkbox">
						        {{image}}
						      </label>
						    </li>
								{% endfor %}
						    </ul>#}
								{% endif %}

								<script>
								 var ideaFiles = [];
								 <!-- a list of already uploaded files -->
								 {% if idea.extraData.images %}
								 {% for image in idea.extraData.images %}
								 ideaFiles.push({
									 source: '{"url":"{{image}}"}',
									 options : {
										 type: 'local',
										 // mock file information
										 file: {
											 name: '{{image}}',
											 //		 size: 3001025,
											 //	 type: 'image/png'
										 },
										 metadata: {
		                   poster: '{{image}}',
		                 }
									 }

								 });
								 {% endfor %}
								 {% endif %}
								</script>
								<input type="file" class="imageUploader-gebiedstool filepond-gebiedstool" multiple />

							</fieldset>
							<input type="hidden" name="validateImages" multiple />
						</div>
					</div>

					<script src="/js/vendor/browser-polyfill.min.js"></script>
					<script src="/js/vendor/filepond-polyfill.min.js"></script>
					<script src="/js/vendor/filepond.js"></script>

					<script src="/js/vendor/filepond-plugin-image-preview.js"></script>
					<script src="/js/vendor/filepond-plugin-file-validate-type.js"></script>
					<script src="/js/vendor/filepond-plugin-file-validate-size.js"></script>
					<script src="/js/vendor/filepond-plugin-file-poster.js"></script>
					<script src="/js/vendor/filepond-plugin-image-exif-orientation.js"></script>
					
					<script>

					 var imageuploader;
					 window.initImageUpload = function() {

						 var fieldsetElement = document.querySelector('.filepondFieldset2');
						 if (fieldsetElement) {
							 FilePond.registerPlugin(FilePondPluginImagePreview);
							 FilePond.registerPlugin(FilePondPluginFileValidateSize);
							 FilePond.registerPlugin(FilePondPluginFileValidateType);
							 FilePond.registerPlugin(FilePondPluginFilePoster);

							 FilePond.setOptions({
								 server: '/image'
							 });

							 var filePondSettings = {
								 // set allowed file types with mime types
								 acceptedFileTypes: ['image/*'],
								 allowFileSizeValidation: true,
								 maxFileSize: '5mb',
								 name: 'image',
								 maxFiles: 3,
								 allowBrowse: true,
								 files: ideaFiles,
								 server: {
									 process: '/image',
									 fetch: '/fetch-image?img='
								 },
								 imageResizeTargetWidth: 80,
								 imageResizeTargetHeight: 80,
								 imageCropAspectRatio: '1:1',
								 labelIdle: "Sleep afbeelding(en) naar deze plek of <span class='filepond--label-action'>KLIK HIER</span>",
								 labelInvalidField: "Field contains invalid files",
								 labelFileWaitingForSize: "Wachtend op grootte",
								 labelFileSizeNotAvailable: "Grootte niet beschikbaar",
								 labelFileCountSingular: "Bestand in lijst",
								 labelFileCountPlural: "Bestanden in lijst",
								 labelFileLoading: "Laden",
								 labelFileAdded: "Toegevoegd", // assistive only
								 labelFileLoadError: "Fout bij het uploaden",
								 labelFileRemoved: "Verwijderd", // assistive only
								 labelFileRemoveError: "Fout bij het verwijderen",
								 labelFileProcessing: "Laden",
								 labelFileProcessingComplete: "Afbeelding geladen",
								 labelFileProcessingAborted: "Upload cancelled",
								 labelFileProcessingError: "Error during upload",
								 labelFileProcessingRevertError: "Error during revert",
								 labelTapToCancel: "tap to cancel",
								 labelTapToRetry: "tap to retry",
								 labelTapToUndo: "tap to undo",
								 labelButtonRemoveItem: "Verwijderen",
								 labelButtonAbortItemLoad: "Abort",
								 labelButtonRetryItemLoad: "Retry",
								 labelButtonAbortItemProcessing: "Verwijder",
								 labelButtonUndoItemProcessing: "Undo",
								 labelButtonRetryItemProcessing: "Retry",
								 labelButtonProcessItem: "Upload"
							 }

							 imageuploader = FilePond.create(fieldsetElement, filePondSettings);
							 var sortableInstance;
							 var pondEl = document.querySelector('.filepond--root');

							 document.querySelector('.filepond--root').addEventListener('FilePond:processfile', e => {
								 if (e.detail) {
									 console.log('Error uploding file: ', e.detail);
								 }
								 updateCurrentInput()
							 });

							 document.querySelector('.filepond--root').addEventListener('FilePond:removefile', e => {
								 if (e.detail && e.detail.error) {
									 console.log('Error uploding file: ', e.detail);
								 }
								 updateCurrentInput()
							 });

							 if (currentInput) {
								 imageuploader.addFiles(currentInput.images)
							 }

						 }
					 }


					 function updateCurrentInput() {
						 if (currentInput) {
							 currentInput.images = [];
							 if ( imageuploader && imageuploader.getFiles ) {
								 var images = imageuploader.getFiles();
								 images.forEach((image) => {
									 try {
										 var serverId = JSON.parse(image.serverId)
										 currentInput.images.push(serverId.url)
									 } catch(err) { console.log(err) }
								 });
							 }
						 }
					 }

					 function uploaderAddImages(images) {
						 console.log(1)
						 if (imageuploader) {
							 console.log(2, images)
							 imageuploader.addFiles(images)
						 }
					 }

					</script>


				</div>

			</div>
		</div>
		<div id="step-buttons" class="step-buttons">

			<a href="javascript: void cancelNewIdea(document.querySelector('#new-idea-form'));" class="button-as-text with-close-button">
				Annuleren
			</a>

			<a id="nextButton" href="javascript: openNextStep();" class="button-blue float-right with-arrow-right">
				Volgende
			</a>

			<a id="submitButton" href="javascript: void submitNewIdea(document.querySelector('#new-idea-form'));" class="button-blue float-right hidden">
				Nu verzenden
			</a>

		</div>
	</form>
</div>

<div id="new-idea-result-container">
	<form id="new-idea-form">
		<div class="header clickable" onclick="toggleInfoBlock()">
			Probleem toegevoegd
		</div>
		<div class="content">
			<div class="step">
				<h3>Bedankt voor uw bijdrage!</h3>
				We hebben uw probleem toegevoegd aan de kaart. Andere buurtbewoners kunnen hier nu op reageren.
			</div>
			<a href="javascript: void resetMap()" class="button-blue" style="margin-top: 20px;">
				Sluit af
			</a>
			<br/>
		</div>
	</form>
</div>

<div id="idea-details">
	<div class="header clickable" onclick="toggleInfoBlock()">
		Probleem details
	</div>
	<div class="sub-header arguments-icon arrow-right is-link" onclick="showIdeaArguments()">
		<span id="show-idea-arguments-button-text"></span>
	</div>
	<div class="content">
		<div class="idea-details">

			<div class="images">
			</div>
			<div class="image-template">
				<div class="image" style="background-image: url('[[src]]')"></div>
			</div>

			<div id="edit-idea-link"></div>

			<p class="font-16">
				<strong><span id="before-address-text"></span> <span id="address-text">...</span><span id="city-text" style="display: none;"></span></strong>
			</p>

			<p>
				<strong>Oorzaak:</strong><br/>
				<span id="description"></span>
			</p>

			<p>
				<strong>Oplossing:</strong><br/>
				<span id="solution"></span>
			</p>

			<div class="extra-data">
				<div class="left">
					<strong>Categorie:</strong><br/>
					<span id="categorie"></span><br/>
					<br/>
					<strong>Type&nbsp;afval:</strong><br/>
					<span id="type"></span>
				</div>
				<div class="right">
					<strong>Wanneer:</strong><br/>
					<span id="time"></span>
				</div>
			</div>

			<p class="user-and-date">
				<span id="username"></span> | <span id="date"></span>
			</p>

			<br/><br/>

		</div>
	</div>
</div>

<div id="idea-arguments">
	<div class="header clickable" onclick="toggleInfoBlock()">
		Reacties op dit probleem
	</div>
	<div class="sub-header arrow-left is-link" onclick="showIdeaDetails()">
		<span id="back-to-idea-details-button-text"></span>
	</div>
	<div class="content arguments">
		<div class="not-logged-in">
			<p class="font-16">
				<strong>Om mee te kunnen praten moet je eerst aangemeld zijn.</strong>
			</p>
			<p>
				Je gaat hiervoor naar een nieuwe pagina, en komt daarna weer hier terug.
			</p>
			<a href="/oauth/login?returnTo={{data.currentUrl}}#ideaId=[[ideaId]]&showArguments=[[ideaId]]" class="button-blue">
				Aanmelden
			</a>
		</div>
		<div class="arguments-form">
			<form id="argument-form">
				<div id="step-0" class="step open">
					<p class="font-16">
						<strong>Ervaar jij dit probleem ook? Of wil je op dit probleem aanvullen? Laat het ons hieronder weten!</strong>
					</p>
					<p>
						<h4>Toelichting:</h4>
						<textarea id="description" onfocus="document.querySelector('#form-warning-description').style.display = 'none'"></textarea>
						<div id="charsLeftDescription" class="charsLeft">
							<div class="min">Nog minimaal <span>0</span> tekens</div>
							<div class="max">Je hebt nog <span>0</span> tekens over.</div>
						</div>
						<span id="form-warning-description" class="form-warning">Je toelichting is te [[langkort]]</span>
					</p>
					<br/>
					<a id="submitButton" href="javascript: void submitNewArgument(currentIdea, document.querySelector('#argument-form'));" class="button-blue">
						Plaats reactie
					</a>
				</div>
			</form>
		</div>
		<div class="argument">
			<div class="description"></div>
			<p class="user-and-date">
				<span class="username"></span> | <span class="date"></span>
			</p>
			<div class="votes-and-reactions">
				<div class="votes" onclick="voteForArgument(currentIdea, [[argumentId]])">
					Mee eens (<span class="no-of-votes"></span>)
				</div>
				<div class="reactions" onclick="showIdeaArgumentReactions(currentIdea, [[argumentId]])">
					Reacties (<span class="no-of-reactions"></span>)
				</div>
			</div>
		</div>
	</div>
</div>

<div id="idea-argument-reactions">
	<div class="header clickable" onclick="toggleInfoBlock()">
		Discussie op deze reactie
	</div>
	<div class="sub-header arrow-left-double is-link" onclick="showIdeaDetails()">
		<span id="back-to-idea-details-button-text"></span>
	</div>
	<div class="sub-header arrow-left is-link" onclick="showIdeaArguments(currentIdea)">
		<span id="back-to-idea-arguments-button-text"></span>
	</div>
	<div class="content argument-reactions">
		<div class="title">
			<h4>Discussie op deze reactie</h4>
		</div>
		<div class="argument">
			<div class="description"></div>
			<p class="user-and-date">
				<span class="username"></span> | <span class="date"></span>
			</p>
			<div class="votes-and-reactions">
				<div class="votes" onclick="voteForArgument(currentIdea, [[argumentId]])">
					Mee eens (<span class="no-of-votes"></span>)
				</div>
			</div>
		</div>
		<div class="not-logged-in">
			<p>
				<strong>Om mee te kunnen praten moet je eerst aangemeld zijn.</strong>
			</p>
			<p>
				Je gaat hiervoor naar een nieuwe pagina, en komt daarna weer hier terug.
			</p>
			<a href="/oauth/login?returnTo={{data.currentUrl}}#ideaId=[[ideaId]]&showReactions=[[argumentId]]" class="button-blue">
				Aanmelden
			</a>
		</div>
		<div class="argument-reactions-form">
			<form id="argument-reactions-form">
				<div class="step open">
					<p>
						<h4>Je reactie hierop:</h4>
						<textarea id="description" onfocus="document.querySelector('#form-warning-description').style.display = 'none'"></textarea>
						<div id="charsLeftDescription" class="charsLeft">
							<div class="min">Nog minimaal <span>0</span> tekens</div>
							<div class="max">Je hebt nog <span>0</span> tekens over.</div>
						</div>
						<span id="form-warning-description" class="form-warning">Je toelichting is te [[langkort]]</span>
					</p>
					<br/>
					<a id="submitButton" href="javascript: void submitNewArgumentReaction(currentIdea, document.querySelector('#argument-reactions-form'));" class="button-blue">
						Plaats reactie
					</a>
					<input id="argumentId" type="hidden" value="[[argumentId]]"/>
				</div>
			</form>
		</div>
		<h4>Reacties van anderen:</h4>
		<div class="argument-reaction">
			<div class="description"></div>
			<p class="user-and-date">
				<span class="username"></span> | <span class="date"></span>
			</p>
		</div>
	</div>
</div>
